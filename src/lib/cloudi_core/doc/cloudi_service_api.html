<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Module cloudi_service_api</title>
<link rel="stylesheet" type="text/css" href="stylesheet.css" title="EDoc">
</head>
<body bgcolor="white">
<div class="navbar"><a name="#navbar_top"></a><table width="100%" border="0" cellspacing="0" cellpadding="2" summary="navigation bar"><tr><td><a href="overview-summary.html" target="overviewFrame">Overview</a></td><td><a href="http://www.erlang.org/"><img src="erlang.png" align="right" border="0" alt="erlang logo"></a></td></tr></table></div>
<hr>

<h1>Module cloudi_service_api</h1>
<ul class="index"><li><a href="#description">Description</a></li><li><a href="#types">Data Types</a></li><li><a href="#index">Function Index</a></li><li><a href="#functions">Function Details</a></li></ul>
   <h3><a name="CloudI_Service_API_Module">CloudI Service API Module</a></h3>
   A module that exposes dynamic configuration of CloudI.
<p>Copyright Â© 2011-2013 Michael Truog</p>

<p><b>Version:</b> 1.2.4 Jun 14 2013 14:26:30
  ------------------------------------------------------------------------</p>
<p><b>Authors:</b> Michael Truog (<a href="mailto:mjtruog [at] gmail (dot) com"><tt>mjtruog [at] gmail (dot) com</tt></a>).</p>

<h2><a name="description">Description</a></h2>
   <h3><a name="CloudI_Service_API_Module">CloudI Service API Module</a></h3>
   A module that exposes dynamic configuration of CloudI.
<h2><a name="types">Data Types</a></h2>

<h3 class="typedecl"><a name="type-acl">acl()</a></h3>
<p><tt>acl() = [atom() | string()]</tt></p>


<h3 class="typedecl"><a name="type-dest_list">dest_list()</a></h3>
<p><tt>dest_list() = undefined | <a href="#type-acl">acl()</a></tt></p>


<h3 class="typedecl"><a name="type-dest_refresh">dest_refresh()</a></h3>
<p><tt>dest_refresh() = lazy_closest | immediate_closest | lazy_furthest | immediate_furthest | lazy_random | immediate_random | lazy_local | immediate_local | lazy_remote | immediate_remote | lazy_newest | immediate_newest | lazy_oldest | immediate_oldest | none</tt></p>


<h3 class="typedecl"><a name="type-loglevel">loglevel()</a></h3>
<p><tt>loglevel() = fatal | error | warn | info | debug | trace | off</tt></p>


<h3 class="typedecl"><a name="type-seconds">seconds()</a></h3>
<p><tt>seconds() = 1..3600</tt></p>


<h3 class="typedecl"><a name="type-service_options_external">service_options_external()</a></h3>
<p><tt>service_options_external() = [{priority_default, -128..127} | {queue_limit, undefined | pos_integer()} | {dest_refresh_start, 100..3600000} | {dest_refresh_delay, 100..3600000} | {request_timeout_adjustment, boolean()} | {response_timeout_adjustment, boolean()}]</tt></p>


<h3 class="typedecl"><a name="type-service_options_internal">service_options_internal()</a></h3>
<p><tt>service_options_internal() = [{priority_default, -128..127} | {queue_limit, undefined | pos_integer()} | {dest_refresh_start, 100..3600000} | {dest_refresh_delay, 100..3600000} | {request_timeout_adjustment, boolean()} | {response_timeout_adjustment, boolean()} | {request_pid_uses, infinity | pos_integer()} | {request_pid_options, [{fullsweep_after, non_neg_integer()} | {min_heap_size, non_neg_integer()} | {min_bin_vheap_size, non_neg_integer()}]} | {info_pid_uses, infinity | pos_integer()} | {info_pid_options, [{fullsweep_after, non_neg_integer()} | {min_heap_size, non_neg_integer()} | {min_bin_vheap_size, non_neg_integer()}]} | {duo_mode, boolean()}]</tt></p>


<h2><a name="index">Function Index</a></h2>
<table width="100%" border="1" cellspacing="0" cellpadding="2" summary="function index"><tr><td valign="top"><a href="#acl_add-2">acl_add/2</a></td><td>
  <h4><a name="Add_ACL_entries.">Add ACL entries.</a></h4>
  Add more ACL entries to be later used when starting services.</td></tr>
<tr><td valign="top"><a href="#acl_remove-2">acl_remove/2</a></td><td>
  <h4><a name="Remove_ACL_entries.">Remove ACL entries.</a></h4>
  Remove ACL entries that are no longer needed.</td></tr>
<tr><td valign="top"><a href="#code_path-1">code_path/1</a></td><td>
  <h4><a name="List_all_the_CloudI_Erlang_VM_code_server_search_paths.">List all the CloudI Erlang VM code server search paths.</a></h4>
  The order is the same order the directories are searched.</td></tr>
<tr><td valign="top"><a href="#code_path_add-2">code_path_add/2</a></td><td>
  <h4><a name="Add_a_directory_to_the_CloudI_Erlang_VM_code_server's_search_paths.">Add a directory to the CloudI Erlang VM code server's search paths.</a></h4>
  The path is always appended to the list of search paths (you should not
  need to rely on search path order because of unique naming).</td></tr>
<tr><td valign="top"><a href="#code_path_remove-2">code_path_remove/2</a></td><td>
  <h4><a name="Remove_a_directory_from_the_CloudI_Erlang_VM_code_server's_search_paths.">Remove a directory from the CloudI Erlang VM code server's search paths.</a></h4>
  This doesn't impact any running services, only services that will be
  started in the future.</td></tr>
<tr><td valign="top"><a href="#log_redirect-2">log_redirect/2</a></td><td>
  <h4><a name="Redirect_the_log_output.">Redirect the log output.</a></h4>
  Redirect all local log output to a remote CloudI node.</td></tr>
<tr><td valign="top"><a href="#loglevel_set-2">loglevel_set/2</a></td><td>
  <h4><a name="Modify_the_current_loglevel.">Modify the current loglevel.</a></h4>
  CloudI uses asynchronous logging with flow control (backpressure
  handling) to prevent misbehaving services from causing instability.</td></tr>
<tr><td valign="top"><a href="#nodes-1">nodes/1</a></td><td>
  <h4><a name="List_both_the_connected_and_disconnected_CloudI_nodes.">List both the connected and disconnected CloudI nodes.</a></h4>.</td></tr>
<tr><td valign="top"><a href="#nodes_add-2">nodes_add/2</a></td><td>
  <h4><a name="Add_CloudI_nodes.">Add CloudI nodes.</a></h4>
  Explicitly add a CloudI node name, so that services between all other
  CloudI nodes and the added nodes can send each other service requests.</td></tr>
<tr><td valign="top"><a href="#nodes_alive-1">nodes_alive/1</a></td><td>
  <h4><a name="List_all_the_CloudI_nodes_known_to_be_connected.">List all the CloudI nodes known to be connected.</a></h4>.</td></tr>
<tr><td valign="top"><a href="#nodes_dead-1">nodes_dead/1</a></td><td>
  <h4><a name="List_all_the_CloudI_nodes_that_are_disconnected_but_expected_to_reconnect.">List all the CloudI nodes that are disconnected but expected to reconnect.</a></h4>.</td></tr>
<tr><td valign="top"><a href="#nodes_remove-2">nodes_remove/2</a></td><td>
  <h4><a name="Explicitly_remove_CloudI_nodes.">Explicitly remove CloudI nodes.</a></h4>.</td></tr>
<tr><td valign="top"><a href="#services-1">services/1</a></td><td>
  <h4><a name="List_all_service_instances_with_each_service's_UUID.">List all service instances with each service's UUID.</a></h4>.</td></tr>
<tr><td valign="top"><a href="#services_add-2">services_add/2</a></td><td>
  <h4><a name="Add_service_instances.">Add service instances.</a></h4>
  Provide service configuration using the same syntax found in the
  configuration file (i.e., /usr/local/etc/cloudi/cloudi.conf).</td></tr>
<tr><td valign="top"><a href="#services_remove-2">services_remove/2</a></td><td>
  <h4><a name="Remove_service_instances.">Remove service instances.</a></h4>
  Provide the Service UUIDs for the services that should be stopped.</td></tr>
<tr><td valign="top"><a href="#services_restart-2">services_restart/2</a></td><td>
  <h4><a name="Restart_service_instances.">Restart service instances.</a></h4>
  Provide the Service UUIDs for the services that should be restarted.</td></tr>
</table>

<h2><a name="functions">Function Details</a></h2>

<h3 class="function"><a name="acl_add-2">acl_add/2</a></h3>
<div class="spec">
<p><tt>acl_add(L::[{atom(), [<a href="#type-acl">acl()</a>]}], Timeout::pos_integer()) -&gt; ok</tt><br></p>
</div><p>
  <h4><a name="Add_ACL_entries.">Add ACL entries.</a></h4>
  Add more ACL entries to be later used when starting services. An ACL
  entry is an Erlang atom() -&gt; list(atom() | string()) relationship which
  provides a logical grouping of service name patterns
  (e.g., {api, ["/cloudi/api/"]}). When providing a service name pattern
  for an ACL entry, a non-pattern will be assumed to be a prefix
  (i.e., "/cloudi/api/" == "/cloudi/api/*").</p>

<h3 class="function"><a name="acl_remove-2">acl_remove/2</a></h3>
<div class="spec">
<p><tt>acl_remove(L::[atom()], Timeout::pos_integer()) -&gt; ok</tt><br></p>
</div><p>
  <h4><a name="Remove_ACL_entries.">Remove ACL entries.</a></h4>
  Remove ACL entries that are no longer needed. Running services will
  retain their configuration, so this impacts services that are started
  in the future.</p>

<h3 class="function"><a name="code_path-1">code_path/1</a></h3>
<div class="spec">
<p><tt>code_path(Timeout::pos_integer()) -&gt; [<a href="file.html#type-filename">file:filename()</a>]</tt><br></p>
</div><p>
  <h4><a name="List_all_the_CloudI_Erlang_VM_code_server_search_paths.">List all the CloudI Erlang VM code server search paths.</a></h4>
  The order is the same order the directories are searched.</p>

<h3 class="function"><a name="code_path_add-2">code_path_add/2</a></h3>
<div class="spec">
<p><tt>code_path_add(Dir::<a href="file.html#type-filename">file:filename()</a>, Timeout::pos_integer()) -&gt; ok</tt><br></p>
</div><p>
  <h4><a name="Add_a_directory_to_the_CloudI_Erlang_VM_code_server's_search_paths.">Add a directory to the CloudI Erlang VM code server's search paths.</a></h4>
  The path is always appended to the list of search paths (you should not
  need to rely on search path order because of unique naming).</p>

<h3 class="function"><a name="code_path_remove-2">code_path_remove/2</a></h3>
<div class="spec">
<p><tt>code_path_remove(Dir::<a href="file.html#type-filename">file:filename()</a>, Timeout::pos_integer()) -&gt; ok</tt><br></p>
</div><p>
  <h4><a name="Remove_a_directory_from_the_CloudI_Erlang_VM_code_server's_search_paths.">Remove a directory from the CloudI Erlang VM code server's search paths.</a></h4>
  This doesn't impact any running services, only services that will be
  started in the future.</p>

<h3 class="function"><a name="log_redirect-2">log_redirect/2</a></h3>
<div class="spec">
<p><tt>log_redirect(Node::atom(), Timeout::pos_integer()) -&gt; ok</tt><br></p>
</div><p>
  <h4><a name="Redirect_the_log_output.">Redirect the log output.</a></h4>
  Redirect all local log output to a remote CloudI node.
  Use 'undefined' as the node name to log locally.</p>

<h3 class="function"><a name="loglevel_set-2">loglevel_set/2</a></h3>
<div class="spec">
<p><tt>loglevel_set(Level::<a href="#type-loglevel">loglevel()</a>, Timeout::pos_integer()) -&gt; ok</tt><br></p>
</div><p>
  <h4><a name="Modify_the_current_loglevel.">Modify the current loglevel.</a></h4>
  CloudI uses asynchronous logging with flow control (backpressure
  handling) to prevent misbehaving services from causing instability.</p>

<h3 class="function"><a name="nodes-1">nodes/1</a></h3>
<div class="spec">
<p><tt>nodes(Timeout::pos_integer()) -&gt; [atom()]</tt><br></p>
</div><p>
  <h4><a name="List_both_the_connected_and_disconnected_CloudI_nodes.">List both the connected and disconnected CloudI nodes.</a></h4>
</p>

<h3 class="function"><a name="nodes_add-2">nodes_add/2</a></h3>
<div class="spec">
<p><tt>nodes_add(L::[atom()], Timeout::pos_integer()) -&gt; ok</tt><br></p>
</div><p>
  <h4><a name="Add_CloudI_nodes.">Add CloudI nodes.</a></h4>
  Explicitly add a CloudI node name, so that services between all other
  CloudI nodes and the added nodes can send each other service requests.</p>

<h3 class="function"><a name="nodes_alive-1">nodes_alive/1</a></h3>
<div class="spec">
<p><tt>nodes_alive(Timeout::pos_integer()) -&gt; [atom()]</tt><br></p>
</div><p>
  <h4><a name="List_all_the_CloudI_nodes_known_to_be_connected.">List all the CloudI nodes known to be connected.</a></h4>
</p>

<h3 class="function"><a name="nodes_dead-1">nodes_dead/1</a></h3>
<div class="spec">
<p><tt>nodes_dead(Timeout::pos_integer()) -&gt; [atom()]</tt><br></p>
</div><p>
  <h4><a name="List_all_the_CloudI_nodes_that_are_disconnected_but_expected_to_reconnect.">List all the CloudI nodes that are disconnected but expected to reconnect.</a></h4>
</p>

<h3 class="function"><a name="nodes_remove-2">nodes_remove/2</a></h3>
<div class="spec">
<p><tt>nodes_remove(L::[atom()], Timeout::pos_integer()) -&gt; ok</tt><br></p>
</div><p>
  <h4><a name="Explicitly_remove_CloudI_nodes.">Explicitly remove CloudI nodes.</a></h4>
</p>

<h3 class="function"><a name="services-1">services/1</a></h3>
<div class="spec">
<p><tt>services(Timeout::pos_integer()) -&gt; ok</tt><br></p>
</div><p>
  <h4><a name="List_all_service_instances_with_each_service's_UUID.">List all service instances with each service's UUID.</a></h4>
</p>

<h3 class="function"><a name="services_add-2">services_add/2</a></h3>
<div class="spec">
<p><tt>services_add(L::[#internal{prefix = undefined | string(), module = undefined | atom() | <a href="file.html#type-filename">file:filename()</a>, args = undefined | list(), dest_refresh = undefined | <a href="cloudi_service_api.html#type-dest_refresh">cloudi_service_api:dest_refresh()</a>, timeout_init = undefined | <a href="cloudi_service_api.html#type-timeout_milliseconds">cloudi_service_api:timeout_milliseconds()</a>, timeout_async = undefined | <a href="cloudi_service_api.html#type-timeout_milliseconds">cloudi_service_api:timeout_milliseconds()</a>, timeout_sync = undefined | <a href="cloudi_service_api.html#type-timeout_milliseconds">cloudi_service_api:timeout_milliseconds()</a>, dest_list_deny = undefined | <a href="cloudi_service_api.html#type-dest_list">cloudi_service_api:dest_list()</a>, dest_list_allow = undefined | <a href="cloudi_service_api.html#type-dest_list">cloudi_service_api:dest_list()</a>, count_process = undefined | pos_integer(), max_r = undefined | non_neg_integer(), max_t = undefined | <a href="cloudi_service_api.html#type-seconds">cloudi_service_api:seconds()</a>, options = undefined | <a href="cloudi_service_api.html#type-service_options_internal">cloudi_service_api:service_options_internal()</a>} | #external{prefix = undefined | string(), file_path = undefined | string(), args = undefined | string(), env = undefined | [{string(), string()}], dest_refresh = undefined | <a href="cloudi_service_api.html#type-dest_refresh">cloudi_service_api:dest_refresh()</a>, protocol = undefined | default | local | tcp | udp, buffer_size = undefined | pos_integer(), timeout_init = undefined | <a href="cloudi_service_api.html#type-timeout_milliseconds">cloudi_service_api:timeout_milliseconds()</a>, timeout_async = undefined | <a href="cloudi_service_api.html#type-timeout_milliseconds">cloudi_service_api:timeout_milliseconds()</a>, timeout_sync = undefined | <a href="cloudi_service_api.html#type-timeout_milliseconds">cloudi_service_api:timeout_milliseconds()</a>, dest_list_deny = undefined | <a href="cloudi_service_api.html#type-dest_list">cloudi_service_api:dest_list()</a>, dest_list_allow = undefined | <a href="cloudi_service_api.html#type-dest_list">cloudi_service_api:dest_list()</a>, count_process = undefined | pos_integer(), count_thread = undefined | pos_integer(), max_r = undefined | non_neg_integer(), max_t = undefined | <a href="cloudi_service_api.html#type-seconds">cloudi_service_api:seconds()</a>, options = undefined | <a href="cloudi_service_api.html#type-service_options_external">cloudi_service_api:service_options_external()</a>}], Timeout::pos_integer()) -&gt; ok</tt><br></p>
</div><p>
  <h4><a name="Add_service_instances.">Add service instances.</a></h4>
  Provide service configuration using the same syntax found in the
  configuration file (i.e., /usr/local/etc/cloudi/cloudi.conf).</p>

<h3 class="function"><a name="services_remove-2">services_remove/2</a></h3>
<div class="spec">
<p><tt>services_remove(L::[&lt;&lt;_:128&gt;&gt;], Timeout::pos_integer()) -&gt; ok</tt><br></p>
</div><p>
  <h4><a name="Remove_service_instances.">Remove service instances.</a></h4>
  Provide the Service UUIDs for the services that should be stopped.
  The Service UUID is shown in the output of services/1. When the
  service is stopped, its running instance is removed from CloudI, but
  does not impact any other running instances (even if they are the same
  service module or binary).</p>

<h3 class="function"><a name="services_restart-2">services_restart/2</a></h3>
<div class="spec">
<p><tt>services_restart(L::[&lt;&lt;_:128&gt;&gt;], Timeout::pos_integer()) -&gt; ok</tt><br></p>
</div><p>
  <h4><a name="Restart_service_instances.">Restart service instances.</a></h4>
  Provide the Service UUIDs for the services that should be restarted.
  The Service UUID is shown in the output of services/1. When the service
  is restarted, the old instance is stopped and a new instance is started.
  During the restart delay, it is possible to lose queued service
  requests and received asynchronous responses. Keeping the state
  separate between the service instances is important to prevent failures
  within the new instance.</p>
<hr>

<div class="navbar"><a name="#navbar_bottom"></a><table width="100%" border="0" cellspacing="0" cellpadding="2" summary="navigation bar"><tr><td><a href="overview-summary.html" target="overviewFrame">Overview</a></td><td><a href="http://www.erlang.org/"><img src="erlang.png" align="right" border="0" alt="erlang logo"></a></td></tr></table></div>
<p><i>Generated by EDoc, Jun 14 2013, 14:26:30.</i></p>
</body>
</html>
