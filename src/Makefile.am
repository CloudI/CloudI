#-*-Mode:make;coding:utf-8;tab-width:4;c-basic-offset:4-*-
# ex: set ft=make fenc=utf-8 sts=4 ts=4 sw=4 noet nomod:

ACLOCAL_AMFLAGS = -I m4
SUBDIRS = api lib tests service_api

SCOPE_EXTERNAL = cloudi_x_
SCOPE_ARGS = -s $(SCOPE_EXTERNAL) -p cloudi -b _original \
     -c $(top_srcdir)/lib/ \
     -d $(top_srcdir)/lib/cloudi_core/src \
     -d $(top_srcdir)/lib/cloudi_service_api_requests/src \
     -d $(top_srcdir)/lib/cloudi_service_db/src \
     -d $(top_srcdir)/lib/cloudi_service_db_cassandra/src \
     -d $(top_srcdir)/lib/cloudi_service_db_cassandra_cql/src \
     -d $(top_srcdir)/lib/cloudi_service_db_couchdb/src \
     -d $(top_srcdir)/lib/cloudi_service_db_elasticsearch/src \
     -d $(top_srcdir)/lib/cloudi_service_db_memcached/src \
     -d $(top_srcdir)/lib/cloudi_service_db_mysql/src \
     -d $(top_srcdir)/lib/cloudi_service_db_pgsql/src \
     -d $(top_srcdir)/lib/cloudi_service_db_riak/src \
     -d $(top_srcdir)/lib/cloudi_service_db_tokyotyrant/src \
     -d $(top_srcdir)/lib/cloudi_service_filesystem/src \
     -d $(top_srcdir)/lib/cloudi_service_http_client/src \
     -d $(top_srcdir)/lib/cloudi_service_http_cowboy/src \
     -d $(top_srcdir)/lib/cloudi_service_http_elli/src \
     -d $(top_srcdir)/lib/cloudi_service_map_reduce/src \
     -d $(top_srcdir)/lib/cloudi_service_oauth1/src \
     -d $(top_srcdir)/lib/cloudi_service_queue/src \
     -d $(top_srcdir)/lib/cloudi_service_quorum/src \
     -d $(top_srcdir)/lib/cloudi_service_router/src \
     -d $(top_srcdir)/lib/cloudi_service_tcp/src \
     -d $(top_srcdir)/lib/cloudi_service_timers/src \
     -d $(top_srcdir)/lib/cloudi_service_udp/src \
     -d $(top_srcdir)/lib/cloudi_service_validate/src \
     -d $(top_srcdir)/lib/cloudi_service_zeromq/src \
     -d $(top_srcdir)/lib/cpg/src \
     -d $(top_srcdir)/lib/cpg/test \
     -d $(top_srcdir)/lib/erlang_term/src \
     -d $(top_srcdir)/lib/key2value/src \
     -d $(top_srcdir)/lib/keys1value/src \
     -d $(top_srcdir)/lib/pqueue/src \
     -d $(top_srcdir)/lib/pqueue/test \
     -d $(top_srcdir)/lib/quickrand/src \
     -d $(top_srcdir)/lib/reltool_util/src \
     -d $(top_srcdir)/lib/trie/src \
     -d $(top_srcdir)/lib/uuid/src \
     -d $(top_srcdir)/external/cloudi_x_cowboy/src \
     -d $(top_srcdir)/external/cloudi_x_cowlib/src \
     -d $(top_srcdir)/external/cloudi_x_dynamic_compile/src \
     -d $(top_srcdir)/external/cloudi_x_ecouchdb/src \
     -d $(top_srcdir)/external/cloudi_x_elli/src \
     -d $(top_srcdir)/external/cloudi_x_ememcached/src \
     -d $(top_srcdir)/external/cloudi_x_emysql/src \
     -d $(top_srcdir)/external/cloudi_x_epgsql/src \
     -d $(top_srcdir)/external/cloudi_x_epgsql_wg/src \
     -d $(top_srcdir)/external/cloudi_x_erlang_cassandra/src \
     -d $(top_srcdir)/external/cloudi_x_erlasticsearch/src \
     -d $(top_srcdir)/external/cloudi_x_erlcloud/src \
     -d $(top_srcdir)/external/cloudi_x_erlcql/src \
     -d $(top_srcdir)/external/cloudi_x_etokyotyrant/src \
     -d $(top_srcdir)/external/cloudi_x_goldrush/src \
     -d $(top_srcdir)/external/cloudi_x_jsx/src \
     -d $(top_srcdir)/external/cloudi_x_lager/src \
     -d $(top_srcdir)/external/cloudi_x_lhttpc/src \
     -d $(top_srcdir)/external/cloudi_x_msgpack/src \
     -d $(top_srcdir)/external/cloudi_x_nodefinder/src \
     -d $(top_srcdir)/external/cloudi_x_pgsql/src \
     -d $(top_srcdir)/external/cloudi_x_poolboy/src \
     -d $(top_srcdir)/external/cloudi_x_protobuffs/src \
     -d $(top_srcdir)/external/cloudi_x_ranch/src \
     -d $(top_srcdir)/external/cloudi_x_riak_pb/src \
     -d $(top_srcdir)/external/cloudi_x_riakc/src \
     -d $(top_srcdir)/external/cloudi_x_thrift/src

if PYTHON_SUPPORT
    PYTHON_TEST_HOOK = api-python-test
endif
if RUBY_SUPPORT
    RUBY_TEST_HOOK = api-ruby-test
endif

.PHONY: \
    rebar-directories-compile \
    erlang-applications-scope-add \
    rebar-compile \
    rebar-clean \
    rebar-directories-clean \
    clean-configure \
    rebar-directories-distclean \
    erlang-applications-scope-remove \
    dialyze \
    dialyzer \
    doc \
    docs \
    xref \
    test \
    tests \
	api-python-test \
	api-ruby-test \
    run

all-local: rel/files/app.config \
           erlang-applications-scope-add \
           rebar-directories-compile \
           rebar-compile

rel/files/app.config: rel/files/app.config.in
	$(MKDIR_P) rel/files
	$(SED) -e "s![@]cloudi_confdir[@]!$(cloudi_confdir)!g" \
           -e "s![@]cloudi_logdir[@]!$(cloudi_logdir)!g" \
           $(top_srcdir)/rel/files/app.config.in > \
           $(top_builddir)/$@

rebar-directories-compile:
	$(MKDIR_P) external
	$(MKDIR_P) lib/cloudi_core/ebin
	$(MKDIR_P) lib/cloudi_service_api_requests/ebin
	$(MKDIR_P) lib/cloudi_service_db/ebin
	$(MKDIR_P) lib/cloudi_service_db_cassandra/ebin
	$(MKDIR_P) lib/cloudi_service_db_cassandra_cql/ebin
	$(MKDIR_P) lib/cloudi_service_db_couchdb/ebin
	$(MKDIR_P) lib/cloudi_service_db_elasticsearch/ebin
	$(MKDIR_P) lib/cloudi_service_db_memcached/ebin
	$(MKDIR_P) lib/cloudi_service_db_mysql/ebin
	$(MKDIR_P) lib/cloudi_service_db_pgsql/ebin
	$(MKDIR_P) lib/cloudi_service_db_riak/ebin
	$(MKDIR_P) lib/cloudi_service_db_tokyotyrant/ebin
	$(MKDIR_P) lib/cloudi_service_filesystem/ebin
	$(MKDIR_P) lib/cloudi_service_http_client/ebin
	$(MKDIR_P) lib/cloudi_service_http_cowboy/ebin
	$(MKDIR_P) lib/cloudi_service_http_elli/ebin
	$(MKDIR_P) lib/cloudi_service_map_reduce/ebin
	$(MKDIR_P) lib/cloudi_service_oauth1/ebin
	$(MKDIR_P) lib/cloudi_service_queue/ebin
	$(MKDIR_P) lib/cloudi_service_quorum/ebin
	$(MKDIR_P) lib/cloudi_service_router/ebin
	$(MKDIR_P) lib/cloudi_service_tcp/ebin
	$(MKDIR_P) lib/cloudi_service_timers/ebin
	$(MKDIR_P) lib/cloudi_service_udp/ebin
	$(MKDIR_P) lib/cloudi_service_validate/ebin
	$(MKDIR_P) lib/cloudi_service_zeromq/ebin
	$(MKDIR_P) lib/pqueue/ebin
	$(MKDIR_P) lib/quickrand/ebin
	$(MKDIR_P) lib/cpg/ebin
	$(MKDIR_P) lib/erlang_term/ebin
	$(MKDIR_P) lib/uuid/ebin
	$(MKDIR_P) lib/trie/ebin
	$(MKDIR_P) lib/reltool_util/ebin
	$(MKDIR_P) lib/key2value/ebin
	$(MKDIR_P) lib/keys1value/ebin
	$(MKDIR_P) lib/service/ebin
	$(MKDIR_P) external/rebar_modules/ebin
	$(MKDIR_P) external/cloudi_x_msgpack/ebin
	$(MKDIR_P) external/cloudi_x_nodefinder/ebin
	$(MKDIR_P) external/cloudi_x_erlcloud/ebin
	$(MKDIR_P) external/cloudi_x_lager/ebin
	$(MKDIR_P) external/cloudi_x_lhttpc/ebin
	$(MKDIR_P) external/cloudi_x_jsx/ebin
	$(MKDIR_P) external/cloudi_x_goldrush/ebin
	$(MKDIR_P) external/cloudi_x_etokyotyrant/ebin
	$(MKDIR_P) external/cloudi_x_poolboy/ebin
	$(MKDIR_P) external/cloudi_x_thrift/ebin
	$(MKDIR_P) external/cloudi_x_erlasticsearch/ebin
	$(MKDIR_P) external/cloudi_x_erlang_cassandra/ebin
	$(MKDIR_P) external/cloudi_x_epgsql/ebin
	$(MKDIR_P) external/cloudi_x_epgsql_wg/ebin
	$(MKDIR_P) external/cloudi_x_pgsql/ebin
	$(MKDIR_P) external/cloudi_x_emysql/ebin
	$(MKDIR_P) external/cloudi_x_ememcached/ebin
	$(MKDIR_P) external/cloudi_x_ecouchdb/ebin
	$(MKDIR_P) external/cloudi_x_cowboy/ebin
	$(MKDIR_P) external/cloudi_x_cowlib/ebin
	$(MKDIR_P) external/cloudi_x_ranch/ebin
	$(MKDIR_P) external/cloudi_x_elli/ebin
	$(MKDIR_P) external/cloudi_x_dynamic_compile/ebin
	$(MKDIR_P) external/cloudi_x_erlcql/ebin
	$(MKDIR_P) external/cloudi_x_protobuffs/ebin
	$(MKDIR_P) external/cloudi_x_riakc/ebin
	$(MKDIR_P) external/cloudi_x_riak_pb/ebin
	$(MKDIR_P) external/lz4/ebin
	$(MKDIR_P) external/snappy/ebin
	$(MKDIR_P) external/syslog/ebin
	(cd $(top_srcdir)/lib/cloudi_core/src && \
        test ! -e cloudi_core.app.src && \
        $(LN_S) $(abs_top_builddir)/lib/cloudi_core/src/cloudi_core.app.src || exit 0)
	(cd $(top_srcdir)/lib/cloudi_service_api_requests/src && \
        test ! -e cloudi_service_api_requests.app.src && \
        $(LN_S) $(abs_top_builddir)/lib/cloudi_service_api_requests/src/cloudi_service_api_requests.app.src || exit 0)
	(cd $(top_srcdir)/lib/cloudi_service_db/src && \
        test ! -e cloudi_service_db.app.src && \
        $(LN_S) $(abs_top_builddir)/lib/cloudi_service_db/src/cloudi_service_db.app.src || exit 0)
	(cd $(top_srcdir)/lib/cloudi_service_db_cassandra/src && \
        test ! -e cloudi_service_db_cassandra.app.src && \
        $(LN_S) $(abs_top_builddir)/lib/cloudi_service_db_cassandra/src/cloudi_service_db_cassandra.app.src || exit 0)
	(cd $(top_srcdir)/lib/cloudi_service_db_cassandra_cql/src && \
        test ! -e cloudi_service_db_cassandra_cql.app.src && \
        $(LN_S) $(abs_top_builddir)/lib/cloudi_service_db_cassandra_cql/src/cloudi_service_db_cassandra_cql.app.src || exit 0)
	(cd $(top_srcdir)/lib/cloudi_service_db_couchdb/src && \
        test ! -e cloudi_service_db_couchdb.app.src && \
        $(LN_S) $(abs_top_builddir)/lib/cloudi_service_db_couchdb/src/cloudi_service_db_couchdb.app.src || exit 0)
	(cd $(top_srcdir)/lib/cloudi_service_db_elasticsearch/src && \
        test ! -e cloudi_service_db_elasticsearch.app.src && \
        $(LN_S) $(abs_top_builddir)/lib/cloudi_service_db_elasticsearch/src/cloudi_service_db_elasticsearch.app.src || exit 0)
	(cd $(top_srcdir)/lib/cloudi_service_db_memcached/src && \
        test ! -e cloudi_service_db_memcached.app.src && \
        $(LN_S) $(abs_top_builddir)/lib/cloudi_service_db_memcached/src/cloudi_service_db_memcached.app.src || exit 0)
	(cd $(top_srcdir)/lib/cloudi_service_db_mysql/src && \
        test ! -e cloudi_service_db_mysql.app.src && \
        $(LN_S) $(abs_top_builddir)/lib/cloudi_service_db_mysql/src/cloudi_service_db_mysql.app.src || exit 0)
	(cd $(top_srcdir)/lib/cloudi_service_db_pgsql/src && \
        test ! -e cloudi_service_db_pgsql.app.src && \
        $(LN_S) $(abs_top_builddir)/lib/cloudi_service_db_pgsql/src/cloudi_service_db_pgsql.app.src || exit 0)
	(cd $(top_srcdir)/lib/cloudi_service_db_riak/src && \
        test ! -e cloudi_service_db_riak.app.src && \
        $(LN_S) $(abs_top_builddir)/lib/cloudi_service_db_riak/src/cloudi_service_db_riak.app.src || exit 0)
	(cd $(top_srcdir)/lib/cloudi_service_db_tokyotyrant/src && \
        test ! -e cloudi_service_db_tokyotyrant.app.src && \
        $(LN_S) $(abs_top_builddir)/lib/cloudi_service_db_tokyotyrant/src/cloudi_service_db_tokyotyrant.app.src || exit 0)
	(cd $(top_srcdir)/lib/cloudi_service_filesystem/src && \
        test ! -e cloudi_service_filesystem.app.src && \
        $(LN_S) $(abs_top_builddir)/lib/cloudi_service_filesystem/src/cloudi_service_filesystem.app.src || exit 0)
	(cd $(top_srcdir)/lib/cloudi_service_http_client/src && \
        test ! -e cloudi_service_http_client.app.src && \
        $(LN_S) $(abs_top_builddir)/lib/cloudi_service_http_client/src/cloudi_service_http_client.app.src || exit 0)
	(cd $(top_srcdir)/lib/cloudi_service_http_cowboy/src && \
        test ! -e cloudi_service_http_cowboy.app.src && \
        $(LN_S) $(abs_top_builddir)/lib/cloudi_service_http_cowboy/src/cloudi_service_http_cowboy.app.src || exit 0)
	(cd $(top_srcdir)/lib/cloudi_service_http_elli/src && \
        test ! -e cloudi_service_http_elli.app.src && \
        $(LN_S) $(abs_top_builddir)/lib/cloudi_service_http_elli/src/cloudi_service_http_elli.app.src || exit 0)
	(cd $(top_srcdir)/lib/cloudi_service_map_reduce/src && \
        test ! -e cloudi_service_map_reduce.app.src && \
        $(LN_S) $(abs_top_builddir)/lib/cloudi_service_map_reduce/src/cloudi_service_map_reduce.app.src || exit 0)
	(cd $(top_srcdir)/lib/cloudi_service_oauth1/src && \
        test ! -e cloudi_service_oauth1.app.src && \
        $(LN_S) $(abs_top_builddir)/lib/cloudi_service_oauth1/src/cloudi_service_oauth1.app.src || exit 0)
	(cd $(top_srcdir)/lib/cloudi_service_queue/src && \
        test ! -e cloudi_service_queue.app.src && \
        $(LN_S) $(abs_top_builddir)/lib/cloudi_service_queue/src/cloudi_service_queue.app.src || exit 0)
	(cd $(top_srcdir)/lib/cloudi_service_quorum/src && \
        test ! -e cloudi_service_quorum.app.src && \
        $(LN_S) $(abs_top_builddir)/lib/cloudi_service_quorum/src/cloudi_service_quorum.app.src || exit 0)
	(cd $(top_srcdir)/lib/cloudi_service_router/src && \
        test ! -e cloudi_service_router.app.src && \
        $(LN_S) $(abs_top_builddir)/lib/cloudi_service_router/src/cloudi_service_router.app.src || exit 0)
	(cd $(top_srcdir)/lib/cloudi_service_tcp/src && \
        test ! -e cloudi_service_tcp.app.src && \
        $(LN_S) $(abs_top_builddir)/lib/cloudi_service_tcp/src/cloudi_service_tcp.app.src || exit 0)
	(cd $(top_srcdir)/lib/cloudi_service_timers/src && \
        test ! -e cloudi_service_timers.app.src && \
        $(LN_S) $(abs_top_builddir)/lib/cloudi_service_timers/src/cloudi_service_timers.app.src || exit 0)
	(cd $(top_srcdir)/lib/cloudi_service_udp/src && \
        test ! -e cloudi_service_udp.app.src && \
        $(LN_S) $(abs_top_builddir)/lib/cloudi_service_udp/src/cloudi_service_udp.app.src || exit 0)
	(cd $(top_srcdir)/lib/cloudi_service_validate/src && \
        test ! -e cloudi_service_validate.app.src && \
        $(LN_S) $(abs_top_builddir)/lib/cloudi_service_validate/src/cloudi_service_validate.app.src || exit 0)
	(cd $(top_srcdir)/lib/cloudi_service_zeromq/src && \
        test ! -e cloudi_service_zeromq.app.src && \
        $(LN_S) $(abs_top_builddir)/lib/cloudi_service_zeromq/src/cloudi_service_zeromq.app.src || exit 0)
	(cd $(top_srcdir)/lib/pqueue/src && \
        test ! -e $(SCOPE_EXTERNAL)pqueue.app.src && \
        $(LN_S) $(abs_top_builddir)/lib/pqueue/src/$(SCOPE_EXTERNAL)pqueue.app.src || exit 0)
	(cd $(top_srcdir)/lib/quickrand/src && \
        test ! -e $(SCOPE_EXTERNAL)quickrand.app.src && \
        $(LN_S) $(abs_top_builddir)/lib/quickrand/src/$(SCOPE_EXTERNAL)quickrand.app.src || exit 0)
	(cd $(top_srcdir)/lib/cpg/src && \
        test ! -e $(SCOPE_EXTERNAL)cpg.app.src && \
        $(LN_S) $(abs_top_builddir)/lib/cpg/src/$(SCOPE_EXTERNAL)cpg.app.src || exit 0)
	(cd $(top_srcdir)/lib/erlang_term/src && \
        test ! -e $(SCOPE_EXTERNAL)erlang_term.app.src && \
        $(LN_S) $(abs_top_builddir)/lib/erlang_term/src/$(SCOPE_EXTERNAL)erlang_term.app.src || exit 0)
	(cd $(top_srcdir)/lib/uuid/src && \
        test ! -e $(SCOPE_EXTERNAL)uuid.app.src && \
        $(LN_S) $(abs_top_builddir)/lib/uuid/src/$(SCOPE_EXTERNAL)uuid.app.src || exit 0)
	(cd $(top_srcdir)/lib/trie/src && \
        test ! -e $(SCOPE_EXTERNAL)trie.app.src && \
        $(LN_S) $(abs_top_builddir)/lib/trie/src/$(SCOPE_EXTERNAL)trie.app.src || exit 0)
	(cd $(top_srcdir)/lib/reltool_util/src && \
        test ! -e $(SCOPE_EXTERNAL)reltool_util.app.src && \
        $(LN_S) $(abs_top_builddir)/lib/reltool_util/src/$(SCOPE_EXTERNAL)reltool_util.app.src || exit 0)
	(cd $(top_srcdir)/lib/key2value/src && \
        test ! -e $(SCOPE_EXTERNAL)key2value.app.src && \
        $(LN_S) $(abs_top_builddir)/lib/key2value/src/$(SCOPE_EXTERNAL)key2value.app.src || exit 0)
	(cd $(top_srcdir)/lib/keys1value/src && \
        test ! -e $(SCOPE_EXTERNAL)keys1value.app.src && \
        $(LN_S) $(abs_top_builddir)/lib/keys1value/src/$(SCOPE_EXTERNAL)keys1value.app.src || exit 0)
	(cd $(top_srcdir)/lib/service/src && \
        test ! -e service.app.src && \
        $(LN_S) $(abs_top_builddir)/lib/service/src/service.app.src || exit 0)
	(cd $(top_srcdir)/lib/cloudi_core && \
        test ! -e ebin && \
        $(LN_S) $(abs_top_builddir)/lib/cloudi_core/ebin || exit 0)
	(cd $(top_srcdir)/lib/cloudi_service_api_requests && \
        test ! -e ebin && \
        $(LN_S) $(abs_top_builddir)/lib/cloudi_service_api_requests/ebin || exit 0)
	(cd $(top_srcdir)/lib/cloudi_service_db && \
        test ! -e ebin && \
        $(LN_S) $(abs_top_builddir)/lib/cloudi_service_db/ebin || exit 0)
	(cd $(top_srcdir)/lib/cloudi_service_db_cassandra && \
        test ! -e ebin && \
        $(LN_S) $(abs_top_builddir)/lib/cloudi_service_db_cassandra/ebin || exit 0)
	(cd $(top_srcdir)/lib/cloudi_service_db_cassandra_cql && \
        test ! -e ebin && \
        $(LN_S) $(abs_top_builddir)/lib/cloudi_service_db_cassandra_cql/ebin || exit 0)
	(cd $(top_srcdir)/lib/cloudi_service_db_couchdb && \
        test ! -e ebin && \
        $(LN_S) $(abs_top_builddir)/lib/cloudi_service_db_couchdb/ebin || exit 0)
	(cd $(top_srcdir)/lib/cloudi_service_db_elasticsearch && \
        test ! -e ebin && \
        $(LN_S) $(abs_top_builddir)/lib/cloudi_service_db_elasticsearch/ebin || exit 0)
	(cd $(top_srcdir)/lib/cloudi_service_db_memcached && \
        test ! -e ebin && \
        $(LN_S) $(abs_top_builddir)/lib/cloudi_service_db_memcached/ebin || exit 0)
	(cd $(top_srcdir)/lib/cloudi_service_db_mysql && \
        test ! -e ebin && \
        $(LN_S) $(abs_top_builddir)/lib/cloudi_service_db_mysql/ebin || exit 0)
	(cd $(top_srcdir)/lib/cloudi_service_db_pgsql && \
        test ! -e ebin && \
        $(LN_S) $(abs_top_builddir)/lib/cloudi_service_db_pgsql/ebin || exit 0)
	(cd $(top_srcdir)/lib/cloudi_service_db_riak && \
        test ! -e ebin && \
        $(LN_S) $(abs_top_builddir)/lib/cloudi_service_db_riak/ebin || exit 0)
	(cd $(top_srcdir)/lib/cloudi_service_db_tokyotyrant && \
        test ! -e ebin && \
        $(LN_S) $(abs_top_builddir)/lib/cloudi_service_db_tokyotyrant/ebin || exit 0)
	(cd $(top_srcdir)/lib/cloudi_service_filesystem && \
        test ! -e ebin && \
        $(LN_S) $(abs_top_builddir)/lib/cloudi_service_filesystem/ebin || exit 0)
	(cd $(top_srcdir)/lib/cloudi_service_http_client && \
        test ! -e ebin && \
        $(LN_S) $(abs_top_builddir)/lib/cloudi_service_http_client/ebin || exit 0)
	(cd $(top_srcdir)/lib/cloudi_service_http_cowboy && \
        test ! -e ebin && \
        $(LN_S) $(abs_top_builddir)/lib/cloudi_service_http_cowboy/ebin || exit 0)
	(cd $(top_srcdir)/lib/cloudi_service_http_elli && \
        test ! -e ebin && \
        $(LN_S) $(abs_top_builddir)/lib/cloudi_service_http_elli/ebin || exit 0)
	(cd $(top_srcdir)/lib/cloudi_service_map_reduce && \
        test ! -e ebin && \
        $(LN_S) $(abs_top_builddir)/lib/cloudi_service_map_reduce/ebin || exit 0)
	(cd $(top_srcdir)/lib/cloudi_service_oauth1 && \
        test ! -e ebin && \
        $(LN_S) $(abs_top_builddir)/lib/cloudi_service_oauth1/ebin || exit 0)
	(cd $(top_srcdir)/lib/cloudi_service_queue && \
        test ! -e ebin && \
        $(LN_S) $(abs_top_builddir)/lib/cloudi_service_queue/ebin || exit 0)
	(cd $(top_srcdir)/lib/cloudi_service_quorum && \
        test ! -e ebin && \
        $(LN_S) $(abs_top_builddir)/lib/cloudi_service_quorum/ebin || exit 0)
	(cd $(top_srcdir)/lib/cloudi_service_router && \
        test ! -e ebin && \
        $(LN_S) $(abs_top_builddir)/lib/cloudi_service_router/ebin || exit 0)
	(cd $(top_srcdir)/lib/cloudi_service_tcp && \
        test ! -e ebin && \
        $(LN_S) $(abs_top_builddir)/lib/cloudi_service_tcp/ebin || exit 0)
	(cd $(top_srcdir)/lib/cloudi_service_timers && \
        test ! -e ebin && \
        $(LN_S) $(abs_top_builddir)/lib/cloudi_service_timers/ebin || exit 0)
	(cd $(top_srcdir)/lib/cloudi_service_udp && \
        test ! -e ebin && \
        $(LN_S) $(abs_top_builddir)/lib/cloudi_service_udp/ebin || exit 0)
	(cd $(top_srcdir)/lib/cloudi_service_validate && \
        test ! -e ebin && \
        $(LN_S) $(abs_top_builddir)/lib/cloudi_service_validate/ebin || exit 0)
	(cd $(top_srcdir)/lib/cloudi_service_zeromq && \
        test ! -e ebin && \
        $(LN_S) $(abs_top_builddir)/lib/cloudi_service_zeromq/ebin || exit 0)
	(cd $(top_srcdir)/lib/pqueue && \
        test ! -e ebin && \
        $(LN_S) $(abs_top_builddir)/lib/pqueue/ebin || exit 0)
	(cd $(top_srcdir)/lib/quickrand && \
        test ! -e ebin && \
        $(LN_S) $(abs_top_builddir)/lib/quickrand/ebin || exit 0)
	(cd $(top_srcdir)/lib/cpg && \
        test ! -e ebin && \
        $(LN_S) $(abs_top_builddir)/lib/cpg/ebin || exit 0)
	(cd $(top_srcdir)/lib/erlang_term && \
        test ! -e ebin && \
        $(LN_S) $(abs_top_builddir)/lib/erlang_term/ebin || exit 0)
	(cd $(top_srcdir)/lib/uuid && \
        test ! -e ebin && \
        $(LN_S) $(abs_top_builddir)/lib/uuid/ebin || exit 0)
	(cd $(top_srcdir)/lib/trie && \
        test ! -e ebin && \
        $(LN_S) $(abs_top_builddir)/lib/trie/ebin || exit 0)
	(cd $(top_srcdir)/lib/reltool_util && \
        test ! -e ebin && \
        $(LN_S) $(abs_top_builddir)/lib/reltool_util/ebin || exit 0)
	(cd $(top_srcdir)/lib/key2value && \
        test ! -e ebin && \
        $(LN_S) $(abs_top_builddir)/lib/key2value/ebin || exit 0)
	(cd $(top_srcdir)/lib/keys1value && \
        test ! -e ebin && \
        $(LN_S) $(abs_top_builddir)/lib/keys1value/ebin || exit 0)
	(cd $(top_srcdir)/lib/service && \
        test ! -e ebin && \
        $(LN_S) $(abs_top_builddir)/lib/service/ebin || exit 0)
	(cd $(top_srcdir)/external/rebar_modules && \
        test ! -e ebin && $(LN_S) \
        $(abs_top_builddir)/external/rebar_modules/ebin || \
        exit 0)
	(cd $(top_srcdir)/external/cloudi_x_msgpack && \
        test ! -e ebin && $(LN_S) \
        $(abs_top_builddir)/external/cloudi_x_msgpack/ebin || \
        exit 0)
	(cd $(top_srcdir)/external/cloudi_x_nodefinder && \
        test ! -e ebin && $(LN_S) \
        $(abs_top_builddir)/external/cloudi_x_nodefinder/ebin || \
        exit 0)
	(cd $(top_srcdir)/external/cloudi_x_erlcloud && \
        test ! -e ebin && $(LN_S) \
        $(abs_top_builddir)/external/cloudi_x_erlcloud/ebin || \
        exit 0)
	(cd $(top_srcdir)/external/cloudi_x_lager && \
        test ! -e ebin && \
        $(LN_S) $(abs_top_builddir)/external/cloudi_x_lager/ebin || exit 0)
	(cd $(top_srcdir)/external/cloudi_x_lhttpc && \
        test ! -e ebin && \
        $(LN_S) $(abs_top_builddir)/external/cloudi_x_lhttpc/ebin || exit 0)
	(cd $(top_srcdir)/external/cloudi_x_jsx && \
        test ! -e ebin && \
        $(LN_S) $(abs_top_builddir)/external/cloudi_x_jsx/ebin || exit 0)
	(cd $(top_srcdir)/external/cloudi_x_goldrush && \
        test ! -e ebin && \
        $(LN_S) $(abs_top_builddir)/external/cloudi_x_goldrush/ebin || exit 0)
	(cd $(top_srcdir)/external/cloudi_x_etokyotyrant && \
        test ! -e ebin && \
        $(LN_S) $(abs_top_builddir)/external/cloudi_x_etokyotyrant/ebin || exit 0)
	(cd $(top_srcdir)/external/cloudi_x_poolboy; \
        test ! -e ebin && \
        $(LN_S) $(abs_top_builddir)/external/cloudi_x_poolboy/ebin || exit 0)
	(cd $(top_srcdir)/external/cloudi_x_thrift; \
        test ! -e ebin && \
        $(LN_S) $(abs_top_builddir)/external/cloudi_x_thrift/ebin || exit 0)
	(cd $(top_srcdir)/external/cloudi_x_erlasticsearch; \
        test ! -e ebin && \
        $(LN_S) $(abs_top_builddir)/external/cloudi_x_erlasticsearch/ebin || exit 0)
	(cd $(top_srcdir)/external/cloudi_x_erlang_cassandra; \
        test ! -e ebin && \
        $(LN_S) $(abs_top_builddir)/external/cloudi_x_erlang_cassandra/ebin || exit 0)
	(cd $(top_srcdir)/external/cloudi_x_epgsql; \
        test ! -e ebin && \
        $(LN_S) $(abs_top_builddir)/external/cloudi_x_epgsql/ebin || exit 0)
	(cd $(top_srcdir)/external/cloudi_x_epgsql_wg; \
        test ! -e ebin && \
        $(LN_S) $(abs_top_builddir)/external/cloudi_x_epgsql_wg/ebin || exit 0)
	(cd $(top_srcdir)/external/cloudi_x_pgsql; \
        test ! -e ebin && \
        $(LN_S) $(abs_top_builddir)/external/cloudi_x_pgsql/ebin || exit 0)
	(cd $(top_srcdir)/external/cloudi_x_protobuffs; \
        test ! -e ebin && \
        $(LN_S) $(abs_top_builddir)/external/cloudi_x_protobuffs/ebin || exit 0)
	(cd $(top_srcdir)/external/cloudi_x_emysql && \
        test ! -e ebin && \
        $(LN_S) $(abs_top_builddir)/external/cloudi_x_emysql/ebin || exit 0)
	(cd $(top_srcdir)/external/cloudi_x_ememcached && \
        test ! -e ebin && \
        $(LN_S) $(abs_top_builddir)/external/cloudi_x_ememcached/ebin || exit 0)
	(cd $(top_srcdir)/external/cloudi_x_ecouchdb && \
        test ! -e ebin && \
        $(LN_S) $(abs_top_builddir)/external/cloudi_x_ecouchdb/ebin || exit 0)
	(cd $(top_srcdir)/external/cloudi_x_cowboy && \
        test ! -e ebin && \
        $(LN_S) $(abs_top_builddir)/external/cloudi_x_cowboy/ebin || exit 0)
	(cd $(top_srcdir)/external/cloudi_x_cowlib && \
        test ! -e ebin && \
        $(LN_S) $(abs_top_builddir)/external/cloudi_x_cowlib/ebin || exit 0)
	(cd $(top_srcdir)/external/cloudi_x_ranch && \
        test ! -e ebin && \
        $(LN_S) $(abs_top_builddir)/external/cloudi_x_ranch/ebin || exit 0)
	(cd $(top_srcdir)/external/cloudi_x_riak_pb && \
        test ! -e ebin && \
        $(LN_S) $(abs_top_builddir)/external/cloudi_x_riak_pb/ebin || exit 0)
	(cd $(top_srcdir)/external/cloudi_x_riakc && \
        test ! -e ebin && \
        $(LN_S) $(abs_top_builddir)/external/cloudi_x_riakc/ebin || exit 0)
	(cd $(top_srcdir)/external/cloudi_x_elli && \
        test ! -e ebin && \
        $(LN_S) $(abs_top_builddir)/external/cloudi_x_elli/ebin || exit 0)
	(cd $(top_srcdir)/external/cloudi_x_dynamic_compile && \
        test ! -e ebin && \
        $(LN_S) $(abs_top_builddir)/external/cloudi_x_dynamic_compile/ebin || exit 0)
	(cd $(top_srcdir)/external/cloudi_x_erlcql && \
        test ! -e ebin && \
        $(LN_S) $(abs_top_builddir)/external/cloudi_x_erlcql/ebin || exit 0)
	(cd $(top_srcdir)/external/syslog && \
        test ! -e ebin && \
        $(LN_S) $(abs_top_builddir)/external/syslog/ebin || exit 0)
	(cd $(top_srcdir)/external/lz4 && \
        test ! -e ebin && \
        $(LN_S) $(abs_top_builddir)/external/lz4/ebin || exit 0)
	(cd $(top_srcdir)/external/snappy && \
        test ! -e ebin && \
        $(LN_S) $(abs_top_builddir)/external/snappy/ebin || exit 0)
	(cd $(top_builddir)/external/cloudi_x_epgsql && \
        test ! -e include && \
        $(LN_S) $(abs_top_srcdir)/external/cloudi_x_epgsql/include || exit 0)
	(cd $(top_builddir)/external/cloudi_x_epgsql_wg && \
        test ! -e include && \
        $(LN_S) $(abs_top_srcdir)/external/cloudi_x_epgsql_wg/include || exit 0)
	(cd $(top_builddir)/external/cloudi_x_emysql && \
        test ! -e include && \
        $(LN_S) $(abs_top_srcdir)/external/cloudi_x_emysql/include || exit 0)
	(cd $(top_builddir)/external/cloudi_x_elli && \
        test ! -e include && \
        $(LN_S) $(abs_top_srcdir)/external/cloudi_x_elli/include || exit 0)
	(cd $(top_builddir)/external/cloudi_x_riak_pb && \
        test ! -e include && \
        $(LN_S) $(abs_top_srcdir)/external/cloudi_x_riak_pb/include || exit 0)
	(cd $(top_builddir)/external/cloudi_x_riakc && \
        test ! -e include && \
        $(LN_S) $(abs_top_srcdir)/external/cloudi_x_riakc/include || exit 0)
	(cd $(top_builddir)/external/cloudi_x_erlcql && \
        test ! -e include && \
        $(LN_S) $(abs_top_srcdir)/external/cloudi_x_erlcql/include || exit 0)
	(if test "x$(ZEROMQ_VERSION_MAJOR)" != "x"; then : ; \
        $(MKDIR_P) external/zeromq/v$(ZEROMQ_VERSION_MAJOR) && \
        cd $(top_builddir)/external/zeromq/v$(ZEROMQ_VERSION_MAJOR) && \
            test ! -e erlzmq && \
            $(LN_S) $(abs_top_srcdir)/external/zeromq/v$(ZEROMQ_VERSION_MAJOR)/erlzmq || exit 0; \
     fi)
	(cd $(top_builddir)/lib/uuid && \
        test ! -e include && \
        $(LN_S) $(abs_top_srcdir)/lib/uuid/include || exit 0)
	(cd $(top_builddir)/lib/cpg && \
        test ! -e include && \
        $(LN_S) $(abs_top_srcdir)/lib/cpg/include || exit 0)
	(cd $(top_builddir)/lib/cloudi_core && \
        test ! -e include && \
        $(LN_S) $(abs_top_srcdir)/lib/cloudi_core/include || exit 0)
	(cd $(top_srcdir)/lib/cloudi_core/cxx_src && \
        test ! -e cloudi_os_spawn_vsn_1 && \
        $(LN_S) $(abs_top_builddir)/lib/cloudi_core/cxx_src/cloudi_os_spawn_vsn_1 || exit 0)

erlang-applications-scope-add: scoped

scoped: $(top_srcdir)/external/README.markdown
	rm -f $@ ; echo > $@
	$(ESCRIPT) $(top_srcdir)/lib/reltool_util/scope $(SCOPE_ARGS) -u
	$(ESCRIPT) $(top_srcdir)/lib/reltool_util/scope $(SCOPE_ARGS)

rebar-compile: erlang-applications-scope-add \
               rebar-directories-compile
	(cd $(top_srcdir) && \
     $(ESCRIPT) $(REBAR) -C $(abs_top_builddir)/rebar_src.config compile)

clean-local: rebar-clean \
             rebar-directories-clean
	rm -rf $(top_builddir)/rel/cloudi || exit 0

rebar-clean:
	(cd $(top_srcdir) && \
     $(ESCRIPT) $(REBAR) -C $(abs_top_builddir)/rebar_src.config clean || \
     exit 0)

rebar-directories-clean: rebar-clean
	rmdir $(top_builddir)/lib/cloudi_core/ebin || exit 0
	rm -f $(top_srcdir)/lib/cloudi_core/ebin
	rmdir $(top_builddir)/lib/cloudi_service_api_requests/ebin || exit 0
	rm -f $(top_srcdir)/lib/cloudi_service_api_requests/ebin
	rmdir $(top_builddir)/lib/cloudi_service_db/ebin || exit 0
	rm -f $(top_srcdir)/lib/cloudi_service_db/ebin
	rmdir $(top_builddir)/lib/cloudi_service_db_cassandra/ebin || exit 0
	rm -f $(top_srcdir)/lib/cloudi_service_db_cassandra/ebin
	rmdir $(top_builddir)/lib/cloudi_service_db_cassandra_cql/ebin || exit 0
	rm -f $(top_srcdir)/lib/cloudi_service_db_cassandra_cql/ebin
	rmdir $(top_builddir)/lib/cloudi_service_db_couchdb/ebin || exit 0
	rm -f $(top_srcdir)/lib/cloudi_service_db_couchdb/ebin
	rmdir $(top_builddir)/lib/cloudi_service_db_elasticsearch/ebin || exit 0
	rm -f $(top_srcdir)/lib/cloudi_service_db_elasticsearch/ebin
	rmdir $(top_builddir)/lib/cloudi_service_db_memcached/ebin || exit 0
	rm -f $(top_srcdir)/lib/cloudi_service_db_memcached/ebin
	rmdir $(top_builddir)/lib/cloudi_service_db_mysql/ebin || exit 0
	rm -f $(top_srcdir)/lib/cloudi_service_db_mysql/ebin
	rmdir $(top_builddir)/lib/cloudi_service_db_pgsql/ebin || exit 0
	rm -f $(top_srcdir)/lib/cloudi_service_db_pgsql/ebin
	rmdir $(top_builddir)/lib/cloudi_service_db_riak/ebin || exit 0
	rm -f $(top_srcdir)/lib/cloudi_service_db_riak/ebin
	rmdir $(top_builddir)/lib/cloudi_service_db_tokyotyrant/ebin || exit 0
	rm -f $(top_srcdir)/lib/cloudi_service_db_tokyotyrant/ebin
	rmdir $(top_builddir)/lib/cloudi_service_filesystem/ebin || exit 0
	rm -f $(top_srcdir)/lib/cloudi_service_filesystem/ebin
	rmdir $(top_builddir)/lib/cloudi_service_http_client/ebin || exit 0
	rm -f $(top_srcdir)/lib/cloudi_service_http_client/ebin
	rmdir $(top_builddir)/lib/cloudi_service_http_cowboy/ebin || exit 0
	rm -f $(top_srcdir)/lib/cloudi_service_http_cowboy/ebin
	rmdir $(top_builddir)/lib/cloudi_service_http_elli/ebin || exit 0
	rm -f $(top_srcdir)/lib/cloudi_service_http_elli/ebin
	rmdir $(top_builddir)/lib/cloudi_service_map_reduce/ebin || exit 0
	rm -f $(top_srcdir)/lib/cloudi_service_map_reduce/ebin
	rmdir $(top_builddir)/lib/cloudi_service_oauth1/ebin || exit 0
	rm -f $(top_srcdir)/lib/cloudi_service_oauth1/ebin
	rmdir $(top_builddir)/lib/cloudi_service_queue/ebin || exit 0
	rm -f $(top_srcdir)/lib/cloudi_service_queue/ebin
	rmdir $(top_builddir)/lib/cloudi_service_quorum/ebin || exit 0
	rm -f $(top_srcdir)/lib/cloudi_service_quorum/ebin
	rmdir $(top_builddir)/lib/cloudi_service_router/ebin || exit 0
	rm -f $(top_srcdir)/lib/cloudi_service_router/ebin
	rmdir $(top_builddir)/lib/cloudi_service_tcp/ebin || exit 0
	rm -f $(top_srcdir)/lib/cloudi_service_tcp/ebin
	rmdir $(top_builddir)/lib/cloudi_service_timers/ebin || exit 0
	rm -f $(top_srcdir)/lib/cloudi_service_timers/ebin
	rmdir $(top_builddir)/lib/cloudi_service_udp/ebin || exit 0
	rm -f $(top_srcdir)/lib/cloudi_service_udp/ebin
	rmdir $(top_builddir)/lib/cloudi_service_validate/ebin || exit 0
	rm -f $(top_srcdir)/lib/cloudi_service_validate/ebin
	rmdir $(top_builddir)/lib/cloudi_service_zeromq/ebin || exit 0
	rm -f $(top_srcdir)/lib/cloudi_service_zeromq/ebin
	rmdir $(top_builddir)/lib/pqueue/ebin || exit 0
	rm -f $(top_srcdir)/lib/pqueue/ebin
	rmdir $(top_builddir)/lib/quickrand/ebin || exit 0
	rm -f $(top_srcdir)/lib/quickrand/ebin
	rmdir $(top_builddir)/lib/cpg/ebin || exit 0
	rm -f $(top_srcdir)/lib/cpg/ebin
	rmdir $(top_builddir)/lib/erlang_term/ebin || exit 0
	rm -f $(top_srcdir)/lib/erlang_term/ebin
	rmdir $(top_builddir)/lib/uuid/ebin || exit 0
	rm -f $(top_srcdir)/lib/uuid/ebin
	rmdir $(top_builddir)/lib/trie/ebin || exit 0
	rm -f $(top_srcdir)/lib/trie/ebin
	rmdir $(top_builddir)/lib/reltool_util/ebin || exit 0
	rm -f $(top_srcdir)/lib/reltool_util/ebin
	rmdir $(top_builddir)/lib/key2value/ebin || exit 0
	rm -f $(top_srcdir)/lib/key2value/ebin
	rmdir $(top_builddir)/lib/keys1value/ebin || exit 0
	rm -f $(top_srcdir)/lib/keys1value/ebin
	rmdir $(top_builddir)/lib/service/ebin || exit 0
	rm -f $(top_srcdir)/lib/service/ebin
	rmdir $(top_builddir)/external/rebar_modules/ebin || exit 0
	rm -f $(top_srcdir)/external/rebar_modules/ebin
	rmdir $(top_builddir)/external/cloudi_x_msgpack/ebin || exit 0
	rm -f $(top_srcdir)/external/cloudi_x_msgpack/ebin
	rmdir $(top_builddir)/external/cloudi_x_nodefinder/ebin || exit 0
	rm -f $(top_srcdir)/external/cloudi_x_nodefinder/ebin
	rmdir $(top_builddir)/external/cloudi_x_erlcloud/ebin || exit 0
	rm -f $(top_srcdir)/external/cloudi_x_erlcloud/ebin
	rmdir $(top_builddir)/external/cloudi_x_lager/ebin || exit 0
	rm -f $(top_srcdir)/external/cloudi_x_lager/ebin
	rmdir $(top_builddir)/external/cloudi_x_lhttpc/ebin || exit 0
	rm -f $(top_srcdir)/external/cloudi_x_lhttpc/ebin
	rmdir $(top_builddir)/external/cloudi_x_jsx/ebin || exit 0
	rm -f $(top_srcdir)/external/cloudi_x_jsx/ebin
	rmdir $(top_builddir)/external/cloudi_x_goldrush/ebin || exit 0
	rm -f $(top_srcdir)/external/cloudi_x_goldrush/ebin
	rmdir $(top_builddir)/external/cloudi_x_etokyotyrant/ebin || exit 0
	rm -f $(top_srcdir)/external/cloudi_x_etokyotyrant/ebin
	rmdir $(top_builddir)/external/cloudi_x_poolboy/ebin || exit 0
	rm -f $(top_srcdir)/external/cloudi_x_poolboy/ebin
	rmdir $(top_builddir)/external/cloudi_x_thrift/ebin || exit 0
	rm -f $(top_srcdir)/external/cloudi_x_thrift/ebin
	rmdir $(top_builddir)/external/cloudi_x_erlasticsearch/ebin || exit 0
	rm -f $(top_srcdir)/external/cloudi_x_erlasticsearch/ebin
	rmdir $(top_builddir)/external/cloudi_x_erlang_cassandra/ebin || exit 0
	rm -f $(top_srcdir)/external/cloudi_x_erlang_cassandra/ebin
	rmdir $(top_builddir)/external/cloudi_x_epgsql/ebin || exit 0
	rm -f $(top_srcdir)/external/cloudi_x_epgsql/ebin
	rmdir $(top_builddir)/external/cloudi_x_epgsql_wg/ebin || exit 0
	rm -f $(top_srcdir)/external/cloudi_x_epgsql_wg/ebin
	rmdir $(top_builddir)/external/cloudi_x_pgsql/ebin || exit 0
	rm -f $(top_srcdir)/external/cloudi_x_pgsql/ebin
	rmdir $(top_builddir)/external/cloudi_x_emysql/ebin || exit 0
	rm -f $(top_srcdir)/external/cloudi_x_emysql/ebin
	rmdir $(top_builddir)/external/cloudi_x_ememcached/ebin || exit 0
	rm -f $(top_srcdir)/external/cloudi_x_ememcached/ebin
	rmdir $(top_builddir)/external/cloudi_x_ecouchdb/ebin || exit 0
	rm -f $(top_srcdir)/external/cloudi_x_ecouchdb/ebin
	rmdir $(top_builddir)/external/cloudi_x_cowboy/ebin || exit 0
	rm -f $(top_srcdir)/external/cloudi_x_cowboy/ebin
	rmdir $(top_builddir)/external/cloudi_x_cowlib/ebin || exit 0
	rm -f $(top_srcdir)/external/cloudi_x_cowlib/ebin
	rmdir $(top_builddir)/external/cloudi_x_ranch/ebin || exit 0
	rm -f $(top_srcdir)/external/cloudi_x_ranch/ebin
	rmdir $(top_builddir)/external/cloudi_x_elli/ebin || exit 0
	rm -f $(top_srcdir)/external/cloudi_x_elli/ebin
	rmdir $(top_builddir)/external/cloudi_x_dynamic_compile/ebin || exit 0
	rm -f $(top_srcdir)/external/cloudi_x_dynamic_compile/ebin
	rmdir $(top_builddir)/external/cloudi_x_riak_pb/ebin || exit 0
	rm -f $(top_srcdir)/external/cloudi_x_riak_pb/ebin
	rmdir $(top_builddir)/external/cloudi_x_riakc/ebin || exit 0
	rm -f $(top_srcdir)/external/cloudi_x_riakc/ebin
	rmdir $(top_builddir)/external/cloudi_x_protobuffs/ebin || exit 0
	rm -f $(top_srcdir)/external/cloudi_x_protobuffs/ebin
	rmdir $(top_builddir)/external/cloudi_x_erlcql/ebin || exit 0
	rm -f $(top_srcdir)/external/cloudi_x_erlcql/ebin
	rmdir $(top_builddir)/external/syslog/ebin || exit 0
	rm -f $(top_srcdir)/external/syslog/ebin
	rmdir $(top_builddir)/external/lz4/ebin || exit 0
	rm -f $(top_srcdir)/external/lz4/ebin
	rmdir $(top_builddir)/external/snappy/ebin || exit 0
	rm -f $(top_srcdir)/external/snappy/ebin
	(if test "x$(ZEROMQ_VERSION_MAJOR)" != "x"; then : ; \
       test -d external/zeromq/v$(ZEROMQ_VERSION_MAJOR) && \
       rm -f $(top_builddir)/external/zeromq/v$(ZEROMQ_VERSION_MAJOR)/erlzmq \
             || exit 0; \
     fi)
	(test -L $(top_builddir)/external/cloudi_x_epgsql/include && \
	 rm $(top_builddir)/external/cloudi_x_epgsql/include || \
	 exit 0)
	(test -L $(top_builddir)/external/cloudi_x_emysql/include && \
	 rm $(top_builddir)/external/cloudi_x_emysql/include || \
	 exit 0)
	(test -L $(top_builddir)/external/cloudi_x_elli/include && \
	 rm $(top_builddir)/external/cloudi_x_elli/include || \
	 exit 0)
	(test -L $(top_builddir)/external/cloudi_x_riak_pb/include && \
	 rm $(top_builddir)/external/cloudi_x_riak_pb/include || \
	 exit 0)
	(test -L $(top_builddir)/external/cloudi_x_riakc/include && \
	 rm $(top_builddir)/external/cloudi_x_riakc/include || \
	 exit 0)
	(test -L $(top_builddir)/external/cloudi_x_erlcql/include && \
	 rm $(top_builddir)/external/cloudi_x_erlcql/include || \
	 exit 0)
	(test -L $(top_builddir)/lib/uuid/include && \
	 rm $(top_builddir)/lib/uuid/include || \
	 exit 0)
	(test -L $(top_builddir)/lib/cpg/include && \
	 rm $(top_builddir)/lib/cpg/include || \
	 exit 0)
	(test -L $(top_builddir)/lib/cloudi_core/include && \
	 rm $(top_builddir)/lib/cloudi_core/include || \
	 exit 0)
	(test -L $(top_builddir)/lib/cloudi_core/cxx_src/cloudi_os_spawn_vsn_1 && \
	 rm $(top_builddir)/lib/cloudi_core/cxx_src/cloudi_os_spawn_vsn_1 || \
	 exit 0)

clean-configure: distclean

distclean-local: rebar-directories-distclean \
                 erlang-applications-scope-remove
	rm -f $(top_srcdir)/aclocal.m4 \
          $(top_srcdir)/config.h.in \
		  $(top_srcdir)/config.h.in~ \
          $(top_srcdir)/config/compile \
          $(top_srcdir)/config/config.guess \
          $(top_srcdir)/config/config.sub \
          $(top_srcdir)/config/install-sh \
          $(top_srcdir)/config/ltmain.sh \
          $(top_srcdir)/config/missing \
          $(top_srcdir)/Makefile.in \
          $(top_srcdir)/configure \
          $(top_srcdir)/m4/libtool.m4 \
          $(top_srcdir)/m4/ltoptions.m4 \
          $(top_srcdir)/m4/ltsugar.m4 \
          $(top_srcdir)/m4/ltversion.m4 \
          $(top_srcdir)/m4/lt~obsolete.m4 \
          $(top_builddir)/rel/files/app.config
	rm -rf $(top_srcdir)/autom4te.cache
	rm -rf $(top_srcdir)/tests/.eunit \
           $(top_srcdir)/tests/ct/logs \
           $(top_srcdir)/lib/cloudi_core/test_ct/logs \
           $(top_srcdir)/lib/cloudi_service_db_cassandra/test_ct/logs \
           $(top_srcdir)/lib/cloudi_service_db_cassandra_cql/test_ct/logs \
           $(top_srcdir)/lib/cloudi_service_db_elasticsearch/test_ct/logs \
           $(top_srcdir)/lib/cloudi_service_db_mysql/test_ct/logs \
           $(top_srcdir)/lib/cloudi_service_db_pgsql/test_ct/logs \
           $(top_srcdir)/lib/cloudi_service_db_riak/test_ct/logs \
           $(top_srcdir)/lib/cloudi_service_filesystem/test_ct/logs \
           $(top_srcdir)/lib/cloudi_service_http_client/test_ct/logs \
           $(top_srcdir)/lib/cloudi_service_queue/test_ct/logs \
           $(top_srcdir)/lib/cloudi_service_quorum/test_ct/logs \
           $(top_srcdir)/lib/cloudi_service_oauth1/test_ct/logs \
           $(top_srcdir)/lib/cloudi_service_validate/test_ct/logs
	find $(top_srcdir)/api -name "Makefile.in" | xargs rm -f
	find $(top_srcdir)/lib -name "Makefile.in" | xargs rm -f
	find $(top_srcdir)/tests -name "Makefile.in" | xargs rm -f
	find $(top_srcdir)/service_api -name "Makefile.in" | xargs rm -f

rebar-directories-distclean:
	rm -f $(top_srcdir)/external/rebar/ebin/*.beam
	(cd $(top_srcdir)/external/zeromq/v$(ZEROMQ_VERSION_MAJOR)/zeromq && \
     make distclean || exit 0)
	(cd $(top_srcdir)/external/zeromq/v$(ZEROMQ_VERSION_MAJOR)/erlzmq && \
     $(ESCRIPT) $(REBAR) -C $(abs_top_builddir)/rebar_src.config clean || \
     exit 0)
	test -e $(top_builddir)/rebar && rm -f $(top_builddir)/rebar || exit 0

erlang-applications-scope-remove:
	rm -f scoped
	$(ESCRIPT) $(top_srcdir)/lib/reltool_util/scope $(SCOPE_ARGS) -u

dialyze: all \
         $(top_srcdir)/dialyzer.plt
	$(DIALYZER) --verbose --plt $(top_srcdir)/dialyzer.plt \
              -I lib/cloudi_core/include/ \
              lib/cloudi_core/ebin/ \
              lib/cloudi_service_api_requests/ebin/ \
              lib/cloudi_service_db/ebin/ \
              lib/cloudi_service_db_cassandra/ebin/ \
              lib/cloudi_service_db_cassandra_cql/ebin/ \
              lib/cloudi_service_db_couchdb/ebin/ \
              lib/cloudi_service_db_elasticsearch/ebin/ \
              lib/cloudi_service_db_memcached/ebin/ \
              lib/cloudi_service_db_mysql/ebin/ \
              lib/cloudi_service_db_pgsql/ebin/ \
              lib/cloudi_service_db_riak/ebin/ \
              lib/cloudi_service_db_tokyotyrant/ebin/ \
              lib/cloudi_service_filesystem/ebin/ \
              lib/cloudi_service_http_client/ebin/ \
              lib/cloudi_service_http_cowboy/ebin/ \
              lib/cloudi_service_http_elli/ebin/ \
              lib/cloudi_service_map_reduce/ebin/ \
              lib/cloudi_service_oauth1/ebin/ \
              lib/cloudi_service_queue/ebin/ \
              lib/cloudi_service_quorum/ebin/ \
              lib/cloudi_service_router/ebin/ \
              lib/cloudi_service_tcp/ebin/ \
              lib/cloudi_service_timers/ebin/ \
              lib/cloudi_service_udp/ebin/ \
              lib/cloudi_service_validate/ebin/ \
              lib/cloudi_service_zeromq/ebin/ \
              lib/pqueue/ebin/ \
              lib/quickrand/ebin/ \
              lib/cpg/ebin/ \
              lib/erlang_term/ebin/ \
              lib/uuid/ebin/ \
              lib/trie/ebin/ \
              lib/reltool_util/ebin/ \
              lib/key2value/ebin/ \
              lib/keys1value/ebin/ \
              tests/hexpi/ebin/ \
              tests/request_rate/ebin/ \
              tests/messaging/ebin/ \
              tests/msg_size/ebin/ \
              tests/http_req/ebin/ \
              external/cloudi_x_cowboy/ebin \
              external/cloudi_x_cowlib/ebin \
              external/cloudi_x_dynamic_compile/ebin \
              external/cloudi_x_ecouchdb/ebin \
              external/cloudi_x_elli/ebin \
              external/cloudi_x_ememcached/ebin \
              external/cloudi_x_emysql/ebin \
              external/cloudi_x_epgsql/ebin \
              external/cloudi_x_epgsql_wg/ebin \
              external/cloudi_x_erlasticsearch/ebin \
              external/cloudi_x_erlang_cassandra/ebin \
              external/cloudi_x_erlcql/ebin \
              external/cloudi_x_etokyotyrant/ebin \
              external/cloudi_x_jsx/ebin \
              external/cloudi_x_pgsql/ebin \
              external/cloudi_x_msgpack/ebin \
              external/cloudi_x_nodefinder/ebin \
              external/syslog/ebin
	@echo "No Errors or Warnings Found!"

dialyzer: dialyze

$(top_srcdir)/dialyzer.plt:
	$(DIALYZER) --build_plt --output_plt $(top_srcdir)/dialyzer.plt \
                --apps erts kernel stdlib mnesia crypto inets xmerl sasl \
                       compiler debugger ssl tools

doc: all
	(cd $(top_srcdir) && \
     $(ESCRIPT) $(REBAR) -C $(abs_top_builddir)/rebar_src_test.config doc \
        || exit 0)

docs: doc

xref: all
	(cd $(top_srcdir) && \
     $(ESCRIPT) $(REBAR) -C $(abs_top_builddir)/rebar_src_test.config xref \
        || exit 0)

api-python-test:
	$(PYTHON) $(top_srcdir)/api/python/tests/erlang_tests.py

api-ruby-test:
	$(RUBY) $(top_srcdir)/api/ruby/tests/erlang_tests.rb

test: all $(PYTHON_TEST_HOOK) $(RUBY_TEST_HOOK)
	(cd $(top_srcdir) && \
     $(ESCRIPT) $(REBAR) -C $(abs_top_builddir)/rebar_src_test.config ct && \
     $(ESCRIPT) $(REBAR) -C $(abs_top_builddir)/rebar_src_test.config eunit)

tests: test

uninstall:
	rm -rf "$(DESTDIR)$(cloudi_prefix)"

install-exec-hook: rel/files/app.config
	$(MKDIR_P) "$(DESTDIR)$(bindir)"
	$(MKDIR_P) "$(DESTDIR)$(cloudi_logdir)"
	$(MKDIR_P) "$(DESTDIR)$(cloudi_confdir)"
	$(MKDIR_P) "$(DESTDIR)$(cloudi_bindir)"
	$(MKDIR_P) "$(DESTDIR)$(cloudi_prefix)"
	$(MKDIR_P) "$(DESTDIR)$(cloudi_prefix)/lib"
	$(MKDIR_P) "$(DESTDIR)$(cloudi_prefix)/releases"
	(cd "$(DESTDIR)$(cloudi_prefix)" && \
     test ! -e etc && $(LN_S) "$(cloudi_confdir)" etc || exit 0 && \
     test ! -e logs && $(LN_S) "$(cloudi_logdir)" logs || exit 0)
	test -e "$(DESTDIR)$(cloudi_confdir)/cloudi.conf" && \
       mv -f "$(DESTDIR)$(cloudi_confdir)/cloudi.conf" \
             "$(DESTDIR)$(cloudi_confdir)/cloudi.conf.old" || exit 0
	$(INSTALL_DATA) "$(top_builddir)/$(CLOUDI_CONF)" \
                  "$(DESTDIR)$(cloudi_confdir)/cloudi.conf"
	$(ESCRIPT) $(top_srcdir)/lib/reltool_util/release
	test ! -d "$(DESTDIR)$(cloudi_prefix)/erts-$(ERLANG_ERTS_VER)" && \
       mv -f "$(top_builddir)/rel/cloudi/erts-$(ERLANG_ERTS_VER)" \
             "$(DESTDIR)$(cloudi_prefix)" || exit 0
	$(INSTALL_SCRIPT) "$(top_builddir)/rel/cloudi/bin/cloudi" \
                    "$(DESTDIR)$(cloudi_bindir)/"
	echo "#!/bin/sh"               > "$(CLOUDI_TMP_BIN_SCRIPT)"
	echo "cd $(cloudi_bindir)"     >> "$(CLOUDI_TMP_BIN_SCRIPT)"
	echo "exec ./cloudi \$$*"      >> "$(CLOUDI_TMP_BIN_SCRIPT)"
	$(INSTALL_SCRIPT) "$(CLOUDI_TMP_BIN_SCRIPT)" "$(DESTDIR)$(bindir)/cloudi"
	rm -f "$(CLOUDI_TMP_BIN_SCRIPT)"
	test -e "$(DESTDIR)$(cloudi_confdir)/app.config" && \
       mv -f "$(DESTDIR)$(cloudi_confdir)/app.config" \
             "$(DESTDIR)$(cloudi_confdir)/app.config.old" || exit 0
	$(INSTALL_DATA) "$(top_builddir)/rel/cloudi/etc/app.config" \
                  "$(DESTDIR)$(cloudi_confdir)/"
	test -e "$(DESTDIR)$(cloudi_confdir)/vm.args" && \
       mv -f "$(DESTDIR)$(cloudi_confdir)/vm.args" \
             "$(DESTDIR)$(cloudi_confdir)/vm.args.old" || exit 0
	$(INSTALL_DATA) "$(top_builddir)/rel/cloudi/etc/vm.args" \
                  "$(DESTDIR)$(cloudi_confdir)/"
	test ! -d "$(DESTDIR)$(cloudi_prefix)/releases/1" && \
       mv -f "$(top_builddir)/rel/cloudi/releases/1" \
             "$(DESTDIR)$(cloudi_prefix)/releases/" || exit 0
	$(INSTALL_DATA) "$(top_builddir)/rel/cloudi/releases/start_erl.data" \
                    "$(DESTDIR)$(cloudi_prefix)/releases/"
	list0=`ls "$(top_builddir)/rel/cloudi/lib/"`; \
    for subdir0 in $$list0; do \
	  list1=`ls "$(top_builddir)/rel/cloudi/lib/$$subdir0"`; \
    for subdir1 in $$list1; do \
        test ! -e "$(DESTDIR)$(cloudi_prefix)/lib/$$subdir0/$$subdir1" && \
        $(MKDIR_P) "$(DESTDIR)$(cloudi_prefix)/lib/$$subdir0/" && \
        mv -f "$(top_builddir)/rel/cloudi/lib/$$subdir0/$$subdir1" \
              "$(DESTDIR)$(cloudi_prefix)/lib/$$subdir0/" || \
        echo "$(DESTDIR)$(cloudi_prefix)/lib/$$subdir0/$$subdir1 exists!"; \
    done; done
	rm -rf $(top_builddir)/rel/cloudi/

run:
	@echo
	@echo "********************"
	@echo "* USE make install *"
	@echo "********************"
	@echo
	@exit 1

distdir:
	@echo
	@echo "*************************************"
	@echo "* AUTOMAKE DISTRIBUTION IS NOT USED *"
	@echo "*************************************"
	@echo
	@exit 1

dist: distdir

