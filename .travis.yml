language: erlang
otp_release:
  - 17.0
  - R16B03-1
  - R16B
python:
  - "2.7"
rvm:
  - 1.9.3
before_install:
  - sudo apt-get update
# travis takes care of: make autoconf automake libtool g++ git
  - sudo apt-get install default-jdk libboost-thread-dev libboost-dev libgmp3-dev uuid-dev
  - rm rebar.config
before_script:
  - mkdir build
  - cd build
  - ../src/autogen.sh
  - ../src/configure --with-zeromq --with-cxx-backtrace --prefix=`pwd`/../install_local
  - psql -U postgres -c "CREATE USER cloudi_tests WITH PASSWORD 'cloudi_tests'; CREATE DATABASE cloudi_tests; GRANT ALL PRIVILEGES ON DATABASE cloudi_tests to cloudi_tests;"
script: ../src/make_dev test install || ( find ../src/ -name 'raw.log' | xargs cat && exit 1 )
after_script:
  - make distclean
branches:
  only:
    - master
    - develop
notifications:
  irc: "chat.freenode.net#cloudi"
